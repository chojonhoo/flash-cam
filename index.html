<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <!-- æ ¸å¿ƒä¿®æ”¹ï¼šviewport-fit=cover è®©é¡µé¢å……æ»¡åˆ˜æµ·å’Œåº•éƒ¨å®‰å…¨åŒº -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Flash Camera Pro</title>
    <style>
        :root {
            --primary-color: #ffcc00;
            --text-color: #fff;
            /* åŠ¨æ€è·å–å®‰å…¨åŒºåŸŸè·ç¦»ï¼Œé€‚é…æ‰€æœ‰å…¨é¢å± iPhone */
            --safe-top: env(safe-area-inset-top, 50px); 
            --safe-bottom: env(safe-area-inset-bottom, 34px);
        }

        * { margin: 0; padding: 0; box-sizing: border-box; user-select: none; -webkit-tap-highlight-color: transparent; }

        body {
            background-color: #000;
            font-family: -apple-system, BlinkMacSystemFont, "SF Pro Text", sans-serif;
            height: 100vh;
            width: 100vw;
            overflow: hidden;
            /* ç¦ç”¨iOSå›å¼¹æ•ˆæœ */
            position: fixed; 
        }

        /* è§†é¢‘å±‚ï¼šé“ºæ»¡å…¨å± */
        .camera-view {
            position: absolute;
            top: 0; left: 0;
            width: 100%;
            height: 100%;
            z-index: 1;
            background: #111;
        }

        #videoElement {
            width: 100%;
            height: 100%;
            object-fit: cover; /* æ¨¡æ‹Ÿå…¨é¢å±å–æ™¯ */
            transition: filter 0.3s ease;
        }

        /* æ„å›¾æ¡†çº¿å±‚ */
        .overlays {
            position: absolute;
            top: 0; left: 0;
            width: 100%; height: 100%;
            z-index: 10;
            pointer-events: none;
        }

        .frame-line {
            position: absolute;
            top: 50%; left: 50%;
            transform: translate(-50%, -50%);
            border: 1px solid rgba(255, 255, 255, 0.9);
            box-shadow: 0 0 0 4000px rgba(0, 0, 0, 0.5); /* è¶…å¤§é˜´å½±ä½œä¸ºé®ç½© */
            opacity: 0;
            transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
        }
        .frame-line::after {
            content: attr(data-focal);
            position: absolute;
            bottom: -20px; right: 4px;
            color: #fff; font-size: 10px; font-weight: 600; text-shadow: 0 1px 2px black;
        }

        /* UI é¡¶æ ï¼šé’ˆå¯¹çµåŠ¨å²›é€‚é… */
        .top-bar {
            position: absolute;
            top: 0; left: 0; width: 100%;
            z-index: 20;
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            /* å…³é”®ï¼šé¡¶éƒ¨å†…è¾¹è· = å®‰å…¨åŒº + é¢å¤–ç•™ç™½ */
            padding-top: calc(var(--safe-top) + 10px); 
            padding-left: 24px;
            padding-right: 24px;
            /* æ¸å˜èƒŒæ™¯è®©ç™½è‰²å›¾æ ‡æ›´æ¸…æ™° */
            background: linear-gradient(to bottom, rgba(0,0,0,0.4) 0%, transparent 100%);
            height: 120px; /* ç»™æ¸å˜ç•™å¤Ÿé«˜åº¦ */
        }
        .icon-btn {
            font-size: 20px; color: #fff; opacity: 0.9;
            filter: drop-shadow(0 2px 4px rgba(0,0,0,0.5));
        }

        /* UI åº•æ ï¼šé’ˆå¯¹ Home Indicator é€‚é… */
        .bottom-controls {
            position: absolute;
            bottom: 0; left: 0; width: 100%;
            z-index: 30;
            display: flex;
            flex-direction: column;
            justify-content: flex-end;
            /* å…³é”®ï¼šåº•éƒ¨å†…è¾¹è· = å®‰å…¨åŒº + é¢å¤–ç•™ç™½ */
            padding-bottom: calc(var(--safe-bottom) + 20px); 
            background: linear-gradient(to top, rgba(0,0,0,0.8) 0%, transparent 100%);
            height: 300px;
        }

        /* å‚æ•°èƒ¶å›Š */
        .pills-row {
            display: flex;
            justify-content: center;
            gap: 12px;
            margin-bottom: 30px;
        }
        .pill {
            background: rgba(20, 20, 20, 0.6);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px); /* iOSå¿…é¡»åŠ è¿™ä¸ª */
            border: 0.5px solid rgba(255,255,255,0.15);
            border-radius: 18px;
            height: 36px;
            padding: 0 14px;
            display: flex; align-items: center; gap: 6px;
            color: #eee; font-size: 13px; font-weight: 500;
            transition: 0.2s;
        }
        .pill.active { background: #fff; color: #000; }

        /* å¿«é—¨åŒºåŸŸ */
        .shutter-row {
            display: flex;
            justify-content: space-between; /* ä¸¤ç«¯å¯¹é½ï¼Œä¸­é—´å¿«é—¨ */
            align-items: center;
            padding: 0 40px; /* ä¸¤ä¾§ç•™ç™½ */
            position: relative;
        }

        /* ç›¸å†Œå…¥å£ */
        .gallery-preview {
            width: 48px; height: 48px;
            background: #333;
            border-radius: 8px;
            overflow: hidden;
            border: 1px solid rgba(255,255,255,0.3);
        }
        .gallery-preview img { width: 100%; height: 100%; object-fit: cover; opacity: 0.8; }

        /* å¿«é—¨æŒ‰é’®ï¼šå°ºå¯¸è°ƒå¤§æ–¹ä¾¿æ‹‡æŒ‡ */
        .shutter-outer {
            width: 76px; height: 76px;
            border-radius: 50%;
            border: 4px solid #fff;
            display: flex; align-items: center; justify-content: center;
            /* å¢åŠ ç‚¹å‡»çƒ­åŒº */
            touch-action: manipulation;
        }
        .shutter-inner {
            width: 62px; height: 62px;
            background: #fff;
            border-radius: 50%;
            transition: transform 0.1s;
        }
        .shutter-outer:active .shutter-inner { transform: scale(0.9); }

        /* ç›¸æœºåˆ‡æ¢æŒ‰é’® */
        .cam-switch {
            width: 48px; height: 48px;
            border-radius: 50%;
            background: rgba(30,30,30,0.8);
            backdrop-filter: blur(10px);
            display: flex; align-items: center; justify-content: center;
            color: var(--primary-color);
            font-size: 22px;
            border: 1px solid rgba(255,255,255,0.1);
        }

        /* è°ƒèŠ‚é¢æ¿ */
        .adj-panel {
            position: absolute;
            bottom: 140px; 
            width: 100%;
            display: none;
            flex-direction: column;
            align-items: center;
            animation: slideUp 0.2s cubic-bezier(0.2, 0.8, 0.2, 1);
        }
        .adj-panel.show { display: flex; }
        
        .adj-val { 
            color: var(--primary-color); font-family: monospace; font-size: 16px; font-weight: bold; margin-bottom: 12px; 
            text-shadow: 0 1px 3px rgba(0,0,0,0.8);
        }

        /* è‡ªå®šä¹‰ Slider é€‚é…æ‰‹æŒ‡ç²—ç»† */
        input[type=range] {
            -webkit-appearance: none;
            width: 70%;
            height: 4px;
            background: rgba(255,255,255,0.3);
            border-radius: 2px;
            outline: none;
        }
        input[type=range]::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 24px; height: 24px; /* åŠ å¤§æ»‘å— */
            border-radius: 50%;
            background: #fff;
            box-shadow: 0 2px 5px rgba(0,0,0,0.5);
        }

        /* ç„¦æ®µé€‰æ‹©å™¨ */
        .focal-row { display: flex; gap: 16px; }
        .focal-opt {
            padding: 6px 12px; border-radius: 6px;
            background: rgba(0,0,0,0.6); border: 1px solid #666; color: #ccc;
            font-size: 13px;
        }
        .focal-opt.active { background: #fff; color: #000; border-color: #fff; }

        @keyframes slideUp { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        /* ç›¸æœºæŠ½å±‰ï¼šé€‚é…åœ†è§’å±å¹• */
        .drawer {
            position: absolute;
            bottom: 0; left: 0; width: 100%; height: 320px;
            background: #1c1c1e; /* iOS é»˜è®¤æ·±è‰²èƒŒæ™¯ */
            border-radius: 24px 24px 0 0;
            padding: 24px;
            padding-bottom: calc(var(--safe-bottom) + 20px);
            transform: translateY(100%);
            transition: transform 0.35s cubic-bezier(0.32, 0.72, 0, 1);
            z-index: 50;
        }
        .drawer.open { transform: translateY(0); }
        .drawer-head { display: flex; justify-content: space-between; color: #fff; font-weight: 600; font-size: 17px; margin-bottom: 24px; }
        
        .cam-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 12px; }
        .cam-card { display: flex; flex-direction: column; align-items: center; gap: 8px; opacity: 0.6; }
        .cam-card.selected { opacity: 1; }
        .cam-icon {
            width: 56px; height: 56px;
            background: #2c2c2e; border-radius: 14px;
            display: flex; align-items: center; justify-content: center; font-size: 26px;
            border: 2px solid transparent;
        }
        .cam-card.selected .cam-icon { border-color: var(--primary-color); background: #000; }
        .cam-label { font-size: 11px; color: #98989d; font-weight: 500; }

        /* æ¨¡æ‹Ÿé—ªé»‘ */
        #flash-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: #000; pointer-events: none; opacity: 0; z-index: 100;
        }

        /* æ»¤é•œå®šä¹‰ */
        .f-leica { filter: contrast(1.1) saturate(1.1) brightness(0.95) sepia(0.1); }
        .f-ricoh { filter: grayscale(1) contrast(1.5) brightness(1.1); }
        .f-fuji { filter: saturate(1.2) hue-rotate(-5deg) contrast(1.05); }

    </style>
</head>
<body>

    <!-- æ‘„åƒå¤´ç”»é¢ -->
    <div class="camera-view">
        <!-- iOS Safari/WebView æ”¯æŒ playsinline å±æ€§ï¼Œé˜²æ­¢è§†é¢‘è‡ªåŠ¨å…¨å± -->
        <video id="videoElement" autoplay playsinline muted></video>
    </div>

    <!-- æ„å›¾è¾…åŠ©çº¿ -->
    <div class="overlays">
        <div class="frame-line" id="frameLine" data-focal="50mm"></div>
    </div>

    <!-- é¡¶éƒ¨ -->
    <div class="top-bar">
        <div class="icon-btn">âš¡</div>
        <div class="icon-btn">RAW</div>
    </div>

    <!-- åº•éƒ¨æ§åˆ¶ -->
    <div class="bottom-controls">

        <!-- è°ƒèŠ‚é¢æ¿ -->
        <div class="adj-panel" id="adjPanel">
            <div class="adj-val" id="adjVal">0.0</div>
            <div id="sliderBox" style="width:100%; display:flex; justify-content:center;"></div>
            <div class="focal-row" id="focalBox" style="display:none;">
                <div class="focal-opt active" onclick="setFocal(24)">24</div>
                <div class="focal-opt" onclick="setFocal(35)">35</div>
                <div class="focal-opt" onclick="setFocal(50)">50</div>
                <div class="focal-opt" onclick="setFocal(85)">85</div>
            </div>
        </div>

        <!-- å‚æ•°èƒ¶å›Š -->
        <div class="pills-row">
            <div class="pill" onclick="toggleMode('temp')">
                <span>ğŸŒ¡</span> <span id="txtTemp">5500K</span>
            </div>
            <div class="pill" onclick="toggleMode('ev')">
                <span>â˜€</span> <span id="txtEv">+0.0</span>
            </div>
            <div class="pill" onclick="toggleMode('focal')">
                <span style="font-weight:900; font-family:serif;">f</span> <span id="txtFocal">24mm</span>
            </div>
        </div>

        <!-- åº•éƒ¨å¿«é—¨æ  -->
        <div class="shutter-row">
            <div class="gallery-preview">
                <img src="https://images.unsplash.com/photo-1621517724883-9366df2205c5?w=100&q=80" alt="album">
            </div>
            <div class="shutter-outer" onclick="snap()">
                <div class="shutter-inner"></div>
            </div>
            <div class="cam-switch" onclick="toggleDrawer()">
                ğŸ“·
            </div>
        </div>
    </div>

    <!-- ç›¸æœºé€‰æ‹©æŠ½å±‰ -->
    <div class="drawer" id="camDrawer">
        <div class="drawer-head">
            <span>Cameras</span>
            <span onclick="toggleDrawer()" style="opacity:0.5; font-size:24px;">âŒ„</span>
        </div>
        <div class="cam-grid">
            <div class="cam-card selected" onclick="setCam('leica', this)">
                <div class="cam-icon">ğŸ”´</div><span class="cam-label">M-Classic</span>
            </div>
            <div class="cam-card" onclick="setCam('ricoh', this)">
                <div class="cam-icon">âš«</div><span class="cam-label">GR-Mono</span>
            </div>
            <div class="cam-card" onclick="setCam('fuji', this)">
                <div class="cam-icon">ğŸŸ¢</div><span class="cam-label">NC-Color</span>
            </div>
        </div>
    </div>

    <div id="flash-overlay"></div>

<script>
    // --- 1. è°ƒç”¨çœŸå®æ‘„åƒå¤´ ---
    async function initCamera() {
        try {
            // è¯·æ±‚åç½®æ‘„åƒå¤´
            const stream = await navigator.mediaDevices.getUserMedia({ 
                video: { 
                    facingMode: "environment", // åç½®
                    width: { ideal: 1920 },    // å°½å¯èƒ½é«˜æ¸…
                    height: { ideal: 1080 }
                }, 
                audio: false 
            });
            const video = document.getElementById('videoElement');
            video.srcObject = stream;
        } catch (err) {
            console.error("Camera failed, using fallback img", err);
            // å¦‚æœæ˜¯åœ¨æ¨¡æ‹Ÿå™¨æˆ–æ‹’ç»æƒé™ï¼Œå›é€€åˆ°å›¾ç‰‡
            document.querySelector('.camera-view').innerHTML = 
                '<img src="https://images.unsplash.com/photo-1555436169-20e93ee0a7ac?q=80&w=1000" id="videoElement" style="width:100%;height:100%;object-fit:cover;">';
        }
    }
    // é¡µé¢åŠ è½½åå¯åŠ¨ç›¸æœº
    initCamera();

    // --- 2. äº¤äº’é€»è¾‘ ---
    const state = { mode: null, ev: 0, temp: 5500, focal: 24, cam: 'leica' };
    const els = {
        video: null, // åŠ¨æ€è·å–
        adjPanel: document.getElementById('adjPanel'),
        sliderBox: document.getElementById('sliderBox'),
        focalBox: document.getElementById('focalBox'),
        adjVal: document.getElementById('adjVal'),
        frameLine: document.getElementById('frameLine')
    };

    function getVideoEl() { return document.getElementById('videoElement'); }

    function toggleMode(mode) {
        if (state.mode === mode) {
            // å…³é—­
            state.mode = null;
            els.adjPanel.classList.remove('show');
            resetPills();
            return;
        }
        state.mode = mode;
        els.adjPanel.classList.add('show');
        resetPills();
        
        // æ¸²æŸ“ä¸åŒçš„è°ƒèŠ‚å™¨
        els.sliderBox.innerHTML = '';
        els.focalBox.style.display = 'none';
        
        if (mode === 'ev') {
            els.adjVal.innerText = (state.ev > 0 ? '+' : '') + state.ev.toFixed(1);
            createSlider(-2, 2, 0.1, state.ev, (val) => {
                state.ev = parseFloat(val);
                els.adjVal.innerText = (state.ev > 0 ? '+' : '') + state.ev.toFixed(1);
                document.getElementById('txtEv').innerText = els.adjVal.innerText;
                applyFilter();
            });
        } else if (mode === 'temp') {
            els.adjVal.innerText = state.temp + 'K';
            createSlider(3000, 8000, 100, state.temp, (val) => {
                state.temp = parseInt(val);
                els.adjVal.innerText = state.temp + 'K';
                document.getElementById('txtTemp').innerText = els.adjVal.innerText;
                applyFilter();
            });
        } else if (mode === 'focal') {
            els.adjVal.innerText = 'LENS';
            els.focalBox.style.display = 'flex';
        }
    }

    function createSlider(min, max, step, val, callback) {
        const input = document.createElement('input');
        input.type = 'range';
        input.min = min; input.max = max; input.step = step; input.value = val;
        input.oninput = (e) => callback(e.target.value);
        els.sliderBox.appendChild(input);
    }

    function resetPills() {
        document.querySelectorAll('.pill').forEach(p => p.classList.remove('active'));
    }

    // ç„¦æ®µæ¡†çº¿é€»è¾‘ (iPhone 15 Pro é»˜è®¤ä¸»æ‘„ç­‰æ•ˆ24mm)
    function setFocal(mm) {
        state.focal = mm;
        document.getElementById('txtFocal').innerText = mm + 'mm';
        
        // æ›´æ–°æŒ‰é’®é«˜äº®
        document.querySelectorAll('.focal-opt').forEach(d => 
            d.classList.toggle('active', parseInt(d.innerText) === mm));

        const baseMM = 24; // åŸºç¡€å¹¿è§’
        const line = els.frameLine;
        
        if (mm === baseMM) {
            line.style.opacity = 0; // å…¨å±ä¸æ˜¾ç¤ºæ¡†
        } else {
            // è®¡ç®—ç¼©æ”¾æ¯”ä¾‹
            const ratio = baseMM / mm; // ä¾‹å¦‚ 24/50 = 0.48
            line.style.width = (ratio * 100) + '%';
            // å‡è®¾ 4:3 æ¯”ä¾‹çš„æ¡†çº¿ (iPhoneç…§ç‰‡æ¯”ä¾‹)
            // å±å¹•å¾ˆé•¿(19.5:9)ï¼Œæˆ‘ä»¬éœ€è¦è®¡ç®—ç›¸å¯¹é«˜åº¦
            // ç®€å•å¤„ç†ï¼šé«˜åº¦ä¹ŸæŒ‰æ¯”ä¾‹ç¼©æ”¾ï¼Œå¹¶ä¿æŒ 4:3 å®½é«˜æ¯”
            // å±å¹•å®½ W, é«˜ H. æ¡†å®½ w = W * ratio. æ¡†é«˜ h = w * (4/3). 
            // åœ¨CSSé‡Œç›´æ¥ç”¨ aspect-ratio æ›´å¥½ï¼Œä½†åœ¨æ—§Webviewé‡Œå¯èƒ½ä¸æ”¯æŒï¼Œè¿™é‡Œç®€å•ç”¨å®½é«˜ç™¾åˆ†æ¯”
            // ä¸ºäº†ç®€åŒ–ï¼Œæˆ‘ä»¬å‡è®¾æ¡†çº¿æ˜¯æ­£æ–¹å½¢æˆ–éšå±å¹•æ¯”ä¾‹ï¼Œè¿™é‡Œåšæˆæ¨¡æ‹Ÿ 4:3 çš„æ ·å­:
            line.style.height = `calc(${ratio * 100}vw * 1.33)`; 
            
            line.style.opacity = 1;
            line.setAttribute('data-focal', mm + 'mm');
        }
    }

    // æ»¤é•œæ··åˆé€»è¾‘
    function applyFilter() {
        const v = getVideoEl();
        let filterStr = '';
        
        // åŸºç¡€ç›¸æœºé¢„è®¾
        let contrast = 1, saturate = 1, gray = 0;
        if (state.cam === 'leica') { contrast = 1.1; saturate = 1.1; }
        if (state.cam === 'ricoh') { contrast = 1.5; gray = 1; }
        if (state.cam === 'fuji') { contrast = 1.05; saturate = 1.2; }

        // EV å½±å“äº®åº¦
        const brightness = 1 + (state.ev * 0.15);

        // Temp å½±å“è‰²ç›¸å’Œå¤å¤è‰²
        // ç®€æ˜“æ¨¡æ‹Ÿï¼šå†·æš–è‰²æ¸©
        const tempDiff = state.temp - 5500;
        const hue = (tempDiff / 5000) * 10;
        const sepia = tempDiff > 0 ? (tempDiff/8000) : 0;

        filterStr = `brightness(${brightness}) contrast(${contrast}) saturate(${saturate}) grayscale(${gray}) hue-rotate(${hue}deg) sepia(${sepia})`;
        v.style.filter = filterStr;
    }

    function setCam(type, el) {
        state.cam = type;
        document.querySelectorAll('.cam-card').forEach(c => c.classList.remove('selected'));
        el.classList.add('selected');
        applyFilter();
    }

    function toggleDrawer() {
        document.getElementById('camDrawer').classList.toggle('open');
        state.mode = null;
        els.adjPanel.classList.remove('show');
    }

    function snap() {
        // éœ‡åŠ¨åé¦ˆ (å¦‚æœè®¾å¤‡æ”¯æŒ)
        if (navigator.vibrate) navigator.vibrate(50);
        
        // é»‘å±åŠ¨ç”»
        const flash = document.getElementById('flash-overlay');
        flash.style.opacity = 1;
        setTimeout(() => flash.style.opacity = 0, 150);
    }
</script>
</body>
</html>